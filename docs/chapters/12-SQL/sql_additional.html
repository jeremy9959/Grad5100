<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-99.9.9">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jeremy Teitelbaum">

<title>Fundamentals of Machine Learning - Databases and SQL - A few more keywords</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-sidebar floating fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Databases and SQL - A few more keywords</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">Fundamentals of Machine Learning</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Contents</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/00-OrientationProject/orientation-project.html" class="sidebar-item-text sidebar-link">Orientation Project</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/01-SettingUp/setting-up.html" class="sidebar-item-text sidebar-link">Key Tools for Data Science</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/02-JupyterBasics/jupyter-walkthrough.html" class="sidebar-item-text sidebar-link">Jupyter Lab and Python Walkthrough</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/03-RBasics/r-walkthrough.html" class="sidebar-item-text sidebar-link">R Notebook Walkthrough</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/04-StatBasics/stat-basics.html" class="sidebar-item-text sidebar-link">Statistical Basics</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/05-WorkingWithData/pythonAndR.html" class="sidebar-item-text sidebar-link">Data Structures and Functions in R and Python</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/06-LinearAlgebra/linear_algebra.html" class="sidebar-item-text sidebar-link">Essential Linear Algebra</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/07-Calculus/calculus.html" class="sidebar-item-text sidebar-link">Key ideas from calculus</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/08-Summarizing/grouping_pandas.html" class="sidebar-item-text sidebar-link">Grouping and Summarizing in Pandas</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/08-Summarizing/groupingR.html" class="sidebar-item-text sidebar-link">Grouping and Summarizing in R</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/09-Regexps/pythonFiles.html" class="sidebar-item-text sidebar-link">Reading and Writing to Files in Python</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/09-Regexps/Rfiles.html" class="sidebar-item-text sidebar-link">Reading from and Writing to Files in R</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/09-Regexps/regexpsPython.html" class="sidebar-item-text sidebar-link">Python regexps</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/09-Regexps/regexpsR.html" class="sidebar-item-text sidebar-link">Regexps in R</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/09-Regexps/RegexProblems.html" class="sidebar-item-text sidebar-link">Exercises with Regexps</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/10-Shell/UnixCommandLine.html" class="sidebar-item-text sidebar-link">The UNIX command line</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/11-Git/Git.html" class="sidebar-item-text sidebar-link">Version Control and Git</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/12-SQL/sql.html" class="sidebar-item-text sidebar-link">A brief introduction to Databases and SQL</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Problems</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/999-Problems/HW1.html" class="sidebar-item-text sidebar-link">Homework One</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/999-Problems/Distributions.html" class="sidebar-item-text sidebar-link">Notes on Probability in R</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/999-Problems/HW2.html" class="sidebar-item-text sidebar-link">Homework Two</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/999-Problems/HW2-clean_up_function.html" class="sidebar-item-text sidebar-link">Comments on HW2 - String Clean Up</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/999-Problems/HW2-Iteration.html" class="sidebar-item-text sidebar-link">Comments on HW2 - iteration</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/999-Problems/HW2-Poisson.html" class="sidebar-item-text sidebar-link">HW2 - Comments on Poisson</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/999-Problems/HW3Assignment.html" class="sidebar-item-text sidebar-link">Homework 3</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/999-Problems/HW4Assignment.html" class="sidebar-item-text sidebar-link">Homework 4</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">Resources</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/99-Resources/Cheatsheets.html" class="sidebar-item-text sidebar-link">Cheatsheets and other References</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Databases and SQL - A few more keywords</h1>
<p class="subtitle lead">Fundamentals of Data Science</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jeremy Teitelbaum </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<p>There are a few additional tricks to know about.</p>
<ol type="1">
<li>the HAVING clause. This allows you to put conditions on summary variables. For example, suppose we want to find all actors in the <code>sakila</code> database that appear in only one film. Remember that the relationship between films and actors is captured in the <code>film_actor</code> table.</li>
</ol>
<p>First, we can make a table showing, for each actor_id, how many films that actor appears in.</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="st">select actor_id, count(film_id) as num  from film_actor group by film_id order by num</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>run_sql(query, engine)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>[(70, 1),
 (65, 1),
 (77, 1),
 (198, 1),
 (31, 1),
 (142, 1),
 (4, 1),
 (103, 1),
 (154, 1),
 (13, 1),
 (65, 1),
 (158, 1),
 (16, 1),
 (49, 1),
 (152, 1),
 (32, 1),
 (164, 1),
 (171, 1),
 (159, 1),
 (74, 1),
 (197, 1),
 (74, 2),
 (6, 2),
 (55, 2),
 (12, 2),
 (26, 2),
 (48, 2),
 (82, 2),
 (124, 2),
 (57, 2),
 (2, 2),
 (107, 2),
 (1, 2),
 (21, 2),
 (19, 2),
 (46, 2),
 (57, 2),
 (86, 2),
 (96, 2),
 (48, 2),
 (70, 2),
 (28, 2),
 (78, 2),
 (46, 2),
 (26, 2),
 (81, 2),
 (106, 2),
 (139, 2),
 (51, 2),
 (148, 2),
 (106, 2),
 (76, 2),
 (14, 2),
 (145, 2),
 (29, 2),
 (91, 2),
 (8, 2),
 (102, 2),
 (64, 2),
 (36, 2),
 (142, 2),
 (166, 2),
 (15, 2),
 (102, 2),
 (145, 2),
 (85, 2),
 (50, 2),
 (143, 2),
 (52, 2),
 (66, 2),
 (24, 2),
 (39, 2),
 (99, 2),
 (28, 2),
 (76, 2),
 (76, 2),
 (69, 2),
 (95, 2),
 (103, 2),
 (70, 2),
 (102, 2),
 (121, 2),
 (11, 2),
 (36, 2),
 (106, 2),
 (23, 2),
 (41, 2),
 (59, 2),
 (45, 2),
 (27, 2),
 (71, 3),
 (9, 3),
 (46, 3),
 (118, 3),
 (59, 3),
 (81, 3),
 (39, 3),
 (36, 3),
 (158, 3),
 (15, 3),
 (8, 3),
 (86, 3),
 (120, 3),
 (63, 3),
 (38, 3),
 (19, 3),
 (59, 3),
 (101, 3),
 (9, 3),
 (17, 3),
 (107, 3),
 (16, 3),
 (7, 3),
 (94, 3),
 (10, 3),
 (77, 3),
 (94, 3),
 (16, 3),
 (62, 3),
 (18, 3),
 (22, 3),
 (108, 3),
 (17, 3),
 (2, 3),
 (43, 3),
 (68, 3),
 (27, 3),
 (13, 3),
 (66, 3),
 (174, 3),
 (90, 3),
 (65, 3),
 (43, 3),
 (111, 3),
 (133, 3),
 (12, 3),
 (19, 3),
 (23, 3),
 (39, 3),
 (92, 3),
 (14, 3),
 (16, 3),
 (117, 3),
 (18, 3),
 (64, 3),
 (2, 3),
 (38, 3),
 (9, 3),
 (13, 3),
 (43, 3),
 (60, 3),
 (39, 3),
 (73, 3),
 (100, 3),
 (30, 3),
 (53, 3),
 (27, 3),
 (67, 3),
 (137, 3),
 (119, 3),
 (43, 3),
 (58, 3),
 (24, 3),
 (97, 3),
 (73, 3),
 (95, 3),
 (19, 3),
 (29, 3),
 (31, 3),
 (115, 3),
 (44, 3),
 (19, 3),
 (78, 3),
 (71, 3),
 (55, 3),
 (15, 3),
 (28, 3),
 (48, 3),
 (40, 3),
 (110, 3),
 (18, 3),
 (45, 3),
 (124, 3),
 (13, 3),
 (136, 3),
 (98, 3),
 (44, 3),
 (13, 3),
 (56, 3),
 (23, 3),
 (64, 3),
 (76, 3),
 (42, 3),
 (38, 3),
 (18, 3),
 (120, 3),
 (7, 3),
 (6, 3),
 (42, 3),
 (79, 3),
 (18, 3),
 (50, 3),
 (42, 3),
 (44, 3),
 (59, 3),
 (14, 3),
 (33, 3),
 (89, 3),
 (155, 3),
 (19, 4),
 (55, 4),
 (40, 4),
 (28, 4),
 (45, 4),
 (77, 4),
 (2, 4),
 (12, 4),
 (18, 4),
 (13, 4),
 (58, 4),
 (30, 4),
 (88, 4),
 (30, 4),
 (16, 4),
 (128, 4),
 (24, 4),
 (44, 4),
 (111, 4),
 (1, 4),
 (13, 4),
 (23, 4),
 (92, 4),
 (17, 4),
 (59, 4),
 (29, 4),
 (48, 4),
 (2, 4),
 (49, 4),
 (104, 4),
 (38, 4),
 (31, 4),
 (6, 4),
 (5, 4),
 (7, 4),
 (43, 4),
 (54, 4),
 (8, 4),
 (59, 4),
 (12, 4),
 (33, 4),
 (7, 4),
 (77, 4),
 (41, 4),
 (76, 4),
 (34, 4),
 (82, 4),
 (33, 4),
 (43, 4),
 (29, 4),
 (14, 4),
 (16, 4),
 (5, 4),
 (48, 4),
 (66, 4),
 (32, 4),
 (17, 4),
 (125, 4),
 (12, 4),
 (22, 4),
 (2, 4),
 (103, 4),
 (10, 4),
 (31, 4),
 (90, 4),
 (52, 4),
 (34, 4),
 (94, 4),
 (62, 4),
 (22, 4),
 (86, 4),
 (23, 4),
 (1, 4),
 (3, 4),
 (29, 4),
 (23, 4),
 (51, 4),
 (92, 4),
 (84, 4),
 (22, 4),
 (14, 4),
 (21, 4),
 (9, 4),
 (38, 4),
 (20, 4),
 (5, 4),
 (42, 4),
 (29, 4),
 (2, 4),
 (39, 4),
 (81, 4),
 (74, 4),
 (72, 4),
 (72, 4),
 (20, 4),
 (48, 4),
 (116, 4),
 (41, 4),
 (20, 4),
 (52, 4),
 (32, 4),
 (39, 4),
 (147, 4),
 (26, 4),
 (10, 4),
 (9, 4),
 (41, 4),
 (21, 4),
 (120, 4),
 (25, 4),
 (14, 4),
 (101, 4),
 (28, 4),
 (30, 4),
 (17, 4),
 (21, 4),
 (7, 4),
 (26, 4),
 (56, 4),
 (102, 4),
 (86, 4),
 (51, 4),
 (128, 4),
 (7, 4),
 (9, 4),
 (26, 4),
 (86, 4),
 (82, 4),
 (42, 4),
 (1, 4),
 (66, 4),
 (9, 4),
 (20, 4),
 (80, 4),
 (59, 4),
 (46, 4),
 (100, 4),
 (2, 5),
 (41, 5),
 (51, 5),
 (99, 5),
 (77, 5),
 (12, 5),
 (25, 5),
 (1, 5),
 (38, 5),
 (79, 5),
 (47, 5),
 (66, 5),
 (6, 5),
 (111, 5),
 (4, 5),
 (32, 5),
 (39, 5),
 (23, 5),
 (4, 5),
 (12, 5),
 (76, 5),
 (41, 5),
 (16, 5),
 (17, 5),
 (24, 5),
 (40, 5),
 (42, 5),
 (66, 5),
 (9, 5),
 (27, 5),
 (87, 5),
 (8, 5),
 (39, 5),
 (149, 5),
 (53, 5),
 (3, 5),
 (45, 5),
 (5, 5),
 (8, 5),
 (12, 5),
 (39, 5),
 (66, 5),
 (14, 5),
 (10, 5),
 (115, 5),
 (19, 5),
 (16, 5),
 (20, 5),
 (15, 5),
 (1, 5),
 (63, 5),
 (11, 5),
 (53, 5),
 (39, 5),
 (39, 5),
 (56, 5),
 (70, 5),
 (48, 5),
 (5, 5),
 (37, 5),
 (30, 5),
 (68, 5),
 (3, 5),
 (42, 5),
 (24, 5),
 (13, 5),
 (7, 5),
 (56, 5),
 (31, 5),
 (5, 5),
 (52, 5),
 (36, 5),
 (26, 5),
 (5, 5),
 (40, 5),
 (2, 5),
 (24, 5),
 (62, 5),
 (107, 5),
 (83, 5),
 (12, 5),
 (52, 5),
 (11, 5),
 (9, 5),
 (77, 5),
 (6, 5),
 (13, 5),
 (53, 5),
 (39, 5),
 (10, 5),
 (17, 5),
 (29, 5),
 (34, 5),
 (21, 5),
 (75, 5),
 (50, 5),
 (34, 5),
 (8, 5),
 (26, 5),
 (9, 5),
 (2, 5),
 (49, 5),
 (58, 5),
 (16, 5),
 (20, 5),
 (44, 5),
 (41, 5),
 (48, 5),
 (44, 5),
 (72, 5),
 (55, 5),
 (51, 5),
 (7, 5),
 (22, 5),
 (97, 5),
 (29, 5),
 (20, 5),
 (83, 5),
 (37, 5),
 (32, 5),
 (34, 5),
 (19, 5),
 (9, 5),
 (104, 5),
 (41, 5),
 (26, 5),
 (39, 5),
 (129, 5),
 (3, 5),
 (5, 5),
 (27, 5),
 (58, 5),
 (44, 5),
 (35, 5),
 (34, 5),
 (4, 5),
 (53, 5),
 (5, 5),
 (33, 5),
 (2, 5),
 (15, 5),
 (40, 5),
 (1, 5),
 (43, 5),
 (63, 5),
 (45, 5),
 (7, 5),
 (109, 5),
 (47, 5),
 (99, 5),
 (4, 5),
 (88, 5),
 (39, 5),
 (34, 5),
 (5, 5),
 (11, 5),
 (11, 5),
 (8, 5),
 (42, 5),
 (18, 5),
 (5, 5),
 (12, 5),
 (9, 5),
 (36, 5),
 (33, 5),
 (33, 5),
 (124, 5),
 (14, 5),
 (11, 5),
 (13, 5),
 (7, 5),
 (47, 5),
 (9, 5),
 (49, 5),
 (10, 5),
 (40, 5),
 (8, 5),
 (51, 5),
 (80, 5),
 (53, 5),
 (15, 5),
 (34, 5),
 (52, 5),
 (82, 5),
 (98, 5),
 (53, 5),
 (37, 5),
 (3, 5),
 (44, 5),
 (10, 5),
 (15, 5),
 (37, 5),
 (3, 5),
 (23, 5),
 (52, 5),
 (36, 6),
 (5, 6),
 (52, 6),
 (46, 6),
 (5, 6),
 (67, 6),
 (30, 6),
 (59, 6),
 (9, 6),
 (25, 6),
 (7, 6),
 (26, 6),
 (11, 6),
 (54, 6),
 (33, 6),
 (32, 6),
 (21, 6),
 (43, 6),
 (58, 6),
 (8, 6),
 (26, 6),
 (14, 6),
 (91, 6),
 (9, 6),
 (9, 6),
 (94, 6),
 (68, 6),
 (7, 6),
 (20, 6),
 (23, 6),
 (61, 6),
 (84, 6),
 (50, 6),
 (16, 6),
 (18, 6),
 (11, 6),
 (3, 6),
 (22, 6),
 (31, 6),
 (33, 6),
 (83, 6),
 (5, 6),
 (70, 6),
 (28, 6),
 (27, 6),
 (61, 6),
 (11, 6),
 (50, 6),
 (40, 6),
 (17, 6),
 (13, 6),
 (18, 6),
 (49, 6),
 (55, 6),
 (5, 6),
 (14, 6),
 (56, 6),
 (49, 6),
 (21, 6),
 (29, 6),
 (15, 6),
 (53, 6),
 (38, 6),
 (36, 6),
 (3, 6),
 (55, 6),
 (4, 6),
 (20, 6),
 (65, 6),
 (1, 6),
 (15, 6),
 (42, 6),
 (1, 6),
 (67, 6),
 (13, 6),
 (2, 6),
 (20, 6),
 (10, 6),
 (14, 6),
 (3, 6),
 (64, 6),
 (77, 6),
 (11, 6),
 (42, 6),
 (48, 6),
 (37, 6),
 (17, 6),
 (49, 6),
 (52, 6),
 (24, 6),
 (10, 6),
 (12, 6),
 (1, 6),
 (28, 6),
 (15, 6),
 (12, 6),
 (61, 6),
 (19, 6),
 (54, 6),
 (106, 6),
 (96, 6),
 (12, 6),
 (39, 6),
 (4, 6),
 (6, 6),
 (66, 6),
 (11, 6),
 (4, 6),
 (42, 6),
 (13, 6),
 (35, 6),
 (19, 6),
 (69, 6),
 (7, 6),
 (22, 6),
 (47, 6),
 (45, 6),
 (61, 6),
 (10, 6),
 (17, 6),
 (7, 6),
 (12, 6),
 (23, 6),
 (6, 6),
 (95, 6),
 (12, 6),
 (37, 6),
 (67, 6),
 (74, 6),
 (19, 6),
 (26, 6),
 (15, 6),
 (9, 6),
 (8, 6),
 (26, 6),
 (36, 6),
 (14, 6),
 (37, 6),
 (10, 6),
 (44, 6),
 (7, 6),
 (20, 6),
 (9, 6),
 (33, 6),
 (1, 6),
 (28, 6),
 (23, 6),
 (96, 6),
 (6, 6),
 (13, 6),
 (21, 7),
 (37, 7),
 (6, 7),
 (65, 7),
 (3, 7),
 (3, 7),
 (58, 7),
 (35, 7),
 (6, 7),
 (28, 7),
 (20, 7),
 (45, 7),
 (15, 7),
 (44, 7),
 (3, 7),
 (23, 7),
 (17, 7),
 (16, 7),
 (37, 7),
 (15, 7),
 (29, 7),
 (9, 7),
 (13, 7),
 (12, 7),
 (1, 7),
 (12, 7),
 (24, 7),
 (5, 7),
 (32, 7),
 (38, 7),
 (2, 7),
 (40, 7),
 (43, 7),
 (14, 7),
 (14, 7),
 (8, 7),
 (14, 7),
 (30, 7),
 (27, 7),
 (60, 7),
 (53, 7),
 (2, 7),
 (3, 7),
 (3, 7),
 (23, 7),
 (14, 7),
 (5, 7),
 (13, 7),
 (3, 7),
 (11, 7),
 (8, 7),
 (4, 7),
 (32, 7),
 (45, 7),
 (14, 7),
 (13, 7),
 (69, 7),
 (37, 7),
 (82, 7),
 (15, 7),
 (12, 7),
 (6, 7),
 (17, 7),
 (14, 7),
 (49, 7),
 (48, 7),
 (16, 7),
 (23, 7),
 (7, 7),
 (71, 7),
 (29, 7),
 (57, 7),
 (11, 7),
 (58, 7),
 (14, 7),
 (35, 7),
 (4, 7),
 (28, 7),
 (76, 7),
 (22, 7),
 (41, 7),
 (27, 7),
 (21, 7),
 (108, 7),
 (9, 7),
 (21, 7),
 (21, 7),
 (10, 7),
 (81, 7),
 (12, 7),
 (22, 7),
 (35, 7),
 (2, 7),
 (20, 7),
 (46, 7),
 (16, 7),
 (24, 7),
 (15, 7),
 (80, 7),
 (63, 7),
 (68, 7),
 (37, 7),
 (18, 7),
 (7, 7),
 (14, 7),
 (14, 7),
 (69, 7),
 (40, 7),
 (28, 7),
 (21, 7),
 (21, 7),
 (14, 7),
 (4, 7),
 (64, 7),
 (4, 7),
 (11, 7),
 (36, 7),
 (15, 7),
 (31, 7),
 (29, 8),
 (3, 8),
 (79, 8),
 (7, 8),
 (2, 8),
 (83, 8),
 (4, 8),
 (18, 8),
 (26, 8),
 (2, 8),
 (12, 8),
 (6, 8),
 (83, 8),
 (79, 8),
 (25, 8),
 (13, 8),
 (7, 8),
 (6, 8),
 (17, 8),
 (49, 8),
 (24, 8),
 (25, 8),
 (49, 8),
 (13, 8),
 (6, 8),
 (7, 8),
 (29, 8),
 (25, 8),
 (15, 8),
 (16, 8),
 (27, 8),
 (11, 8),
 (38, 8),
 (1, 8),
 (2, 8),
 (4, 8),
 (14, 8),
 (19, 8),
 (11, 8),
 (38, 8),
 (17, 8),
 (52, 8),
 (18, 8),
 (22, 8),
 (40, 8),
 (5, 8),
 (1, 8),
 (50, 8),
 (10, 8),
 (28, 8),
 (5, 8),
 (47, 8),
 (13, 8),
 (13, 8),
 (17, 8),
 (68, 8),
 (43, 8),
 (3, 8),
 (80, 8),
 (70, 8),
 (5, 8),
 (68, 8),
 (38, 8),
 (16, 8),
 (62, 8),
 (49, 8),
 (58, 8),
 (17, 8),
 (33, 8),
 (8, 8),
 (8, 8),
 (8, 8),
 (39, 8),
 (20, 8),
 (34, 8),
 (2, 8),
 (24, 8),
 (28, 8),
 (91, 8),
 (29, 8),
 (40, 8),
 (17, 8),
 (22, 8),
 (10, 8),
 (21, 8),
 (47, 8),
 (18, 8),
 (12, 8),
 (2, 8),
 (51, 8),
 (10, 9),
 (1, 9),
 (7, 9),
 (28, 9),
 (5, 9),
 (21, 9),
 (5, 9),
 (32, 9),
 (19, 9),
 (12, 9),
 (30, 9),
 (8, 9),
 (15, 9),
 (5, 9),
 (30, 9),
 (50, 9),
 (33, 9),
 (39, 9),
 (44, 9),
 (38, 9),
 (50, 9),
 (75, 9),
 (12, 9),
 (18, 9),
 (14, 9),
 (2, 9),
 (33, 9),
 (20, 9),
 (15, 9),
 (25, 9),
 (28, 9),
 (1, 9),
 (7, 9),
 (5, 9),
 (19, 9),
 (13, 9),
 (14, 9),
 (9, 9),
 (5, 9),
 (57, 9),
 (17, 9),
 (41, 9),
 (11, 9),
 (28, 9),
 (7, 9),
 (11, 9),
 (1, 9),
 (11, 9),
 (33, 9),
 (1, 10),
 (7, 10),
 (13, 10),
 (6, 10),
 (24, 10),
 (12, 10),
 (36, 10),
 (31, 10),
 (2, 10),
 (19, 10),
 (2, 10),
 (11, 10),
 (14, 10),
 (10, 10),
 (40, 10),
 (7, 10),
 (19, 10),
 (1, 10),
 (13, 10),
 (3, 10),
 (3, 10),
 (32, 11),
 (15, 11),
 (12, 11),
 (3, 11),
 (4, 11),
 (15, 11),
 (2, 11),
 (23, 11),
 (21, 11),
 (5, 11),
 (3, 11),
 (27, 11),
 (4, 11),
 (12, 11),
 (12, 12),
 (7, 12),
 (6, 12),
 (26, 12),
 (22, 12),
 (6, 12),
 (3, 13),
 (5, 13),
 (31, 13),
 (2, 13),
 (17, 13),
 (4, 13),
 (28, 15)]</code></pre>
</div>
</div>
<p>To pick out the ones where <code>num</code> is one, we use the <code>having</code> clause.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="st">select actor_id, count(film_id) as num  from film_actor group by film_id  having count(film_id)=1</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>run_sql(query, engine)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>[(70, 1),
 (65, 1),
 (77, 1),
 (198, 1),
 (31, 1),
 (142, 1),
 (4, 1),
 (103, 1),
 (154, 1),
 (13, 1),
 (65, 1),
 (158, 1),
 (16, 1),
 (49, 1),
 (152, 1),
 (32, 1),
 (164, 1),
 (171, 1),
 (159, 1),
 (74, 1),
 (197, 1)]</code></pre>
</div>
</div>
<p><strong>Exercise:</strong> How can you fill out the actor names and film names from this information?</p>
<ol start="2" type="1">
<li>The WITH clause.</li>
</ol>
<p>Suppose you want to find the actors that appear in the most films, it’s a bit trickier One way is to first find the largest number of films, and then join with the table of film counts to pick out those actors having that number of films.</p>
<p>The <code>with</code> clause allows you to nest queries like this.</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="st">with filmcounts as</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="st">    (select actor_id, count(film_id) as num from film_actor group by film_id),</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="st">    maxfilms as</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="st">    (select max(num) as maxnum from filmcounts)</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="st">    select actor_id, num from filmcounts join maxfilms on num=maxnum</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>run_sql(query, engine)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>[(28, 15)]</code></pre>
</div>
</div>
<p><strong>Excercise:</strong> Extend this to include the actor names for these most prolific actors. .</p>
<p>If you want the actors with the second largest number of films, you can try this.</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="st">with filmcounts as</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="st">    (select actor_id, count(film_id) as num from film_actor group by film_id),</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="st">    maxfilms as</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="st">    (select max(num) as maxnum from filmcounts where num &lt; (select max(num) from filmcounts))</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="st">    select actor_id, num from filmcounts join maxfilms on num=maxnum</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>run_sql(query, engine)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>[(3, 13), (5, 13), (31, 13), (2, 13), (17, 13), (4, 13)]</code></pre>
</div>
</div>
<p>If you want, say, the top 5, then you need other techniques.</p>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>